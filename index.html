<!DOCTYPE html>
<html lang="en">
  <head>
    <nav charset="UTF-8" />
    <nav name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script>
      document.title = location.host;
    </script>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <!-- CSS -->
    <link rel="stylesheet" href="https://unpkg.com/bootstrap@4.6.2/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" />

    <link rel="stylesheet" href="./style.css" />
    <style>
      #app-main .container p {
        margin-left: -0.75rem;
        margin-right: -0.75rem;
        /* display: none; */
        line-height: 24px;
      }
    </style>
  </head>
  <body>
    <div id="app" class="container-fluid">
      <aside id="app-sidebar"></aside>
      <main id="app-main" class="container">
        <div class="jumbotron text-center p-0 mb-3" style="background-color: rgba(0, 0, 0, 0.3)">
          <h1 id="app-time" class="font-weight-bolder text-light display-2">--:--:--</h1>
          <p id="app-date" class="lead text-light">--- -- ---</p>
        </div>
        <div class="row -masonry d-none">
          <div class="col col--1 px-0" data-id="1">
            <div class="card text-center border-0" style="background-color: transparent">
              <div class="card-body py-0 px-1 position-absolute" style="top: 0; width: 100%">
                <i class="bi bi-circle"></i>
              </div>
              <div class="card-footer py-0 position-absolute" style="bottom: 0; width: 100%">title</div>
            </div>
          </div>
          <div class="col col--1 px-0" data-id="2"><div class="card border-0"></div></div>
          <div class="col col--1 px-0" data-id="3"><div class="card border-0"></div></div>
          <div class="col col--1 px-0" data-id="4"><div class="card border-0"></div></div>
          <div class="col col--1 px-0" data-id="5"><div class="card border-0"></div></div>
          <div class="col col--1 px-0" data-id="6"><div class="card border-0"></div></div>
          <div class="col col--1 px-0" data-id="7"><div class="card border-0"></div></div>
          <div class="col col--3 px-0" data-id="8"><div class="card border-0"></div></div>
          <div class="col col--2 px-0" data-id="9"><div class="card border-0"></div></div>
          <div class="col col--1 px-0" data-id="10"><div class="card border-0"></div></div>
          <div class="col col--1 px-0" data-id="11"><div class="card border-0"></div></div>
          <div class="col col--3 px-0" data-id="12"><div class="card border-0"></div></div>
          <div class="col col--2 px-0" data-id="13"><div class="card border-0"></div></div>
          <div class="col col--1 px-0" data-id="14"><div class="card border-0"></div></div>
          <div class="col col--1 px-0" data-id="15"><div class="card border-0"></div></div>
          <div class="col col--1 px-0" data-id="16"><div class="card border-0"></div></div>
          <div class="col col--1 px-0" data-id="17"><div class="card border-0"></div></div>
          <div class="col col--1 px-0" data-id="18"><div class="card border-0"></div></div>
          <div class="col col--1 px-0" data-id="19"><div class="card border-0"></div></div>
          <div class="col col--1 px-0" data-id="20"><div class="card border-0"></div></div>
          <div class="col col--1 px-0" data-id="21"><div class="card border-0"></div></div>
          <div class="col col--1 px-0" data-id="22"><div class="card border-0"></div></div>
          <div class="col col--1 px-0" data-id="23"><div class="card border-0"></div></div>
          <div class="col col--1 px-0" data-id="24"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--3 px-0" data-id="12"><div class="card border-0"></div></div>
          <div class="col col--2 px-0" data-id="13"><div class="card border-0"></div></div>
          <div class="col col--1 px-0" data-id="14"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
          <div class="col col--1 px-0"><div class="card border-0"></div></div>
        </div>
        <div class="row justify-content-center mb-3">
          <div class="col--8">
            <div class="input-group input-group-lg rounded-pill mb-0">
              <div class="input-group-prepend">
                <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false">Engine</button>
                <div class="dropdown-menu">
                  <a class="dropdown-item" href="#">Baidu</a>
                  <a class="dropdown-item" href="#">Google</a>
                  <a class="dropdown-item" href="#">Bing</a>
                </div>
              </div>
              <input type="text" class="form-control border-0 text-light" placeholder="Recipient's username" aria-label="Recipient's username" aria-describedby="basic-addon2" style="background-color: rgba(0, 0, 0, 0.3)" />
              <div class="input-group-append">
                <span class="input-group-text" id="basic-addon2">Search</span>
              </div>
            </div>
          </div>
        </div>

        <ul id="app-tab" class="nav nav-pills nav-justified mb-3" id="myTab" role="tablist" style="background-color: rgba(0, 0, 0, 0.3)"></ul>

        <div id="app-tab-content" class="tab-content" id="myTabContent"></div>
      </main>
    </div>
    <div class="wallpaper" style="background-image: url('https://files.codelife.cc/wallhaven/full/0q/wallhaven-0qd3xd.jpg?x-oss-process=image/resize,limit_0,m_fill,w_1920,h_1080/quality,Q_93/format,webp')"></div>
    <!-- jQuery and JavaScript Bundle with Popper -->
    <script src="https://unpkg.com/jquery@3.5.1/dist/jquery.slim.js"></script>
    <script src="https://unpkg.com/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

    <script src="https://unpkg.com/masonry-layout@4.2.2/dist/masonry.pkgd.min.js"></script>

    <script src="https://unpkg.com/moment@2.30.1/min/moment.min.js"></script>
    <script src="https://unpkg.com/moment@2.30.1/min/locales.min.js"></script>
    <script src="https://unpkg.com/moment-lunar@0.0.4/moment-lunar.js"></script>

    <script src="https://unpkg.com/lodash@4.17.21/lodash.min.js"></script>
    <script src="https://unpkg.com/simple-ini@1.0.4/lib/simple-ini.js"></script>

    <script src="./script.js"></script>
    <script>
      moment.locale("zh-CN");
      $(function () {
        setInterval(function () {
          $("#app-time").text(moment().format("HH:mm:ss"));
        }, 500);
        $("#app-date").text(moment().format("M月D日 dddd") + " " + moment().lunar().format("MMMMDo"));
      });
      function getTime() {
        var date = new Date();

        // 年、月、日
        var year = date.getFullYear();
        var month = ("00" + (date.getMonth() + 1)).slice(-2);
        var day = ("00" + date.getDate()).slice(-2);

        // 时、分、秒
        var hour = ("00" + date.getHours()).slice(-2);
        var minute = ("00" + date.getMinutes()).slice(-2);
        var second = ("00" + date.getSeconds()).slice(-2);

        // 实时显示
        var element = document.getElementById("app-time");
        element.innerText = "" + year + "-" + month + "-" + day + " " + hour + ":" + minute + ":" + second;
      }

      // setInterval("getTime()", 1000);
      function isEmpty(value) {
        // 判断 null 或 undefined
        if (value === null || value === undefined) return true;

        // 判断空字符串
        if (typeof value === "string" && value.trim() === "") return true;

        // 判断空数组
        if (Array.isArray(value) && value.length === 0) return true;

        // 判断空对象
        if (typeof value === "object" && Object.keys(value).length === 0) return true;

        return false;
      }
      $(function () {
        function makeBreadcrumb(key, root) {
          // console.log(key);
          const data = { ...(root[key] || {}) };
          if (isEmpty(data.NAME)) data.NAME = key;
          return `<div class="row">
          <nav class="col px-2.5" aria-label="breadcrumb">
            <ol class="breadcrumb py-2">
              <li class="breadcrumb-ite" aria-current="page">${data.NAME}</li>
            </ol>
          </nav>
          </div>`;
        }
        function makeCardGroup(key, root) {
          // console.log(key);
          // console.log(root[key]);
          const data = { ...(root[key] || {}) };
          return (
            `<div class="row row-cols-1 row-cols-sm-2 row-cols-md-4">` +
            (data["CHILDREN"] || "")
              .split(",")
              .filter((v) => v)
              .reduce((t, v) => t + makeCard(v, key, root), "") +
            ` </div>`
          );
        }
        function makeCard(key, parentKey, root) {
          const data = { ...(root[parentKey + "::" + key] || {}) };
          // console.log(key, parentKey, isEmpty(data.NAME));
          // console.log(data);
          if (isEmpty(data.NAME)) data.NAME = key;
          // console.log(data);
          return (
            (isEmpty(data.URL) ? "" : `<a class="text-decoration-none" target="_blank" href="${data.URL}">`) +
            `` +
            `<div class="col px-2.5">
              <div class="card border-0">
              <div class="card-body px-2.5 py-2">
                <div class="media">
                <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" class="align-self-center mr-1 text-secondary" style="width: 1.5rem">
                  <path d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div class="media-body">
                  <h5 class="my-0">${data.NAME}</h5>
                </div>
              </div>
              </div>
              </div>
            </div>` +
            (isEmpty(data.URL) ? "" : `</a>`)
          );
        }
        function makeHtml(data) {
          return (data["CHILDREN"] || "")
            .split(",")
            .filter((v) => v)
            .reduce((t, v) => t + makeBreadcrumb(v, data) + makeCardGroup(v, data), "");
        }
        function loadHtml() {
          fetch("./.env?" + Date.now())
            .then((response) => response.text())
            .then((res) => {
              const iniObject = new SimpleIni(function () {
                return res.replace(/\r/g, "");
              });
              // console.log(iniObject);
              // console.log(iniObject["CHILDREN"].split(",").slice(0, -1));
              $("#app").html(makeHtml({ ...iniObject }));
            });
        }

        // loadHtml();
      });
      $(function () {
        fetch("./dataset.json?" + Date.now())
          .then((response) => response.json())
          .then((res) => {
            console.log(res);
            const { navs } = res;
            let tabHtml = ``;
            let tabContentHtml = ``;
            navs.forEach((nav, i) => {
              tabHtml += `
                  <li class="nav-item" role="presentation">
                    <button class="nav-link btn-block text-light font-weight-bolder ${i == 0 ? "active" : ""}" id="${nav.slug}-tab" data-toggle="tab" data-target="#${nav.slug}" type="button" role="tab" aria-controls="${nav.slug}" aria-selected="true">
                      ${nav.name || _.upperFirst(nav.slug)}
                    </button>
                  </li>
                  `;

              tabContentHtml += `<div class="tab-pane fade ${i == 0 ? "show active" : ""}" id="${nav.slug}" role="tabpanel" aria-labelledby="${nav.slug}-tab"> <div class="row row-cols-12 row-cols-sm-10 row-cols-md-12 text-center masonry">`;
              tabContentHtml += `<div class="col col--1 row--1 masonry-item px-0 text-decoration-none" data-id="0"></div>`;
              (nav.children || []).forEach((child, index) => {
                tabContentHtml +=
                  `<div class="col col--${child.col || 1} row--${child.row || 1} masonry-item px-0 text-decoration-none" data-id="${index + 1}">` +
                  ` <div class="card border-0" style="">
                      <div class="card-body p-0 position-absolute" style="background-image: url(${child.ico || ""}); background-size: contain">` +
                  `     <div class="row row-cols-3 mx-0 align-items-center" style="height: 100%;">` +
                  (child.children || []).slice(0, 3).reduce(
                    (tol, chd) =>
                      tol +
                      `<div class="col col--1 row--1 px-2">
                        <div class="card border-0 bg-light" style="background-image: url(${chd.ico || ""}); background-size: contain">
                        </div>
                       </div>`,
                    ``
                  ) +
                  `     </div>` +
                  `   </div>
                      <div class="card-footer p-0 position-absolute text-light text-truncate" style="bottom: 0; width: 100%">${child.title || child.name || _.upperFirst(child.slug)}</div>  
                    </div>` +
                  `</div>`;
              });
              tabContentHtml += `</div> </div>`;
            });
            $("#app-tab").html(tabHtml);
            $("#app-tab-content").html(tabContentHtml);
            $(".masonry:nth-child(1)").masonry({
              // options
              itemSelector: ".masonry-item",
              percentPosition: true,
            });
            $('button[data-toggle="tab"]').on("shown.bs.tab", function (event) {
              console.log(event.target);
              console.log(event.relatedTarget);
              console.log($(event.target).data("target"));
              console.log($(event.relatedTarget).data("target"));
              $($(event.target).data("target") + ">.masonry").masonry({
                // options
                itemSelector: ".masonry-item",
                percentPosition: true,
              });
            });
          })
          .then((res) => {});
      });
    </script>
  </body>
</html>
