<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <!-- CSS -->
    <link rel="stylesheet" href="https://unpkg.com/bootstrap@4.6.2/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" />

    <link rel="stylesheet" href="https://unpkg.com/@fortawesome/fontawesome-free@7.0.0/css/all.css" />

    <script>
      (function () {
        var style = document.createElement('link');
        style.rel = 'stylesheet';
        style.href = './style.css?v=' + Date.now();
        document.head.appendChild(style);
      })();
    </script>
    <style></style>
    <script>
      document.title = location.host;
    </script>
  </head>
  <body>
    <div id="app" class="container-fluid">
      <aside id="app-sidebar"></aside>
      <main id="app-main" class="container">
        <div class="jumbotron text-center p-0 mb-2" style="background-color: rgba(0, 0, 0, 0.3)">
          <h1 id="app-time" class="font-weight-bolder text-light display-2">--:--:--</h1>
          <p id="app-date" class="lead text-light mb-0">--- -- ---</p>
        </div>
        <div class="row justify-content-center mb-3 d-none">
          <div class="col-8">
            <div class="input-group input-group-lg rounded-pill mb-0">
              <div class="input-group-prepend">
                <button class="btn btn-outline-secondary border-0 dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false">Engine</button>
                <div class="dropdown-menu">
                  <a class="dropdown-item" href="#">Baidu</a>
                  <a class="dropdown-item" href="#">Google</a>
                  <a class="dropdown-item" href="#">Bing</a>
                </div>
              </div>
              <input type="text" class="form-control border-0 text-light" placeholder="Recipient's username" aria-label="Recipient's username" aria-describedby="basic-addon2" style="background-color: rgba(0, 0, 0, 0.3)" />
              <div class="input-group-append">
                <span class="input-group-text" id="basic-addon2">Search</span>
              </div>
            </div>
          </div>
        </div>
        <div id="app-carousel" class="carousel slide flex-grow-1" data-touch="false" data-interval="false">
          <ol id="app-carousel--indicators" class="carousel-indicators mb-0"></ol>
          <div id="app-carousel--inner" class="carousel-inner"></div>
        </div>
        <footer id="app-footer" class="py-2">
          <div class="progress" style="opacity: 0.4">
            <div class="progress-bar progress-bar-striped bg-info" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
        </footer>
      </main>
    </div>
    <div class="wallpaper" style="background-image: url('https://files.codelife.cc/wallhaven/full/0q/wallhaven-0qd3xd.jpg?x-oss-process=image/resize,limit_0,m_fill,w_1920,h_1080/quality,Q_93/format,webp')"></div>
    <!-- jQuery and JavaScript Bundle with Popper -->
    <script src="https://unpkg.com/jquery@3.3.1/dist/jquery.slim.min.js"></script>
    <script src="https://unpkg.com/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- <script src="https://unpkg.com/bootstrap-menu@1.0.14/dist/BootstrapMenu.min.js"></script> -->

    <script src="https://unpkg.com/jquery-lazyload@1.9.7/jquery.lazyload.js"></script>

    <script src="https://unpkg.com/bootstrap-menu@1.0.14/dist/BootstrapMenu.min.js"></script>

    <script src="https://unpkg.com/masonry-layout@4.2.2/dist/masonry.pkgd.min.js"></script>

    <script src="https://unpkg.com/moment@2.30.1/min/moment.min.js"></script>
    <script src="https://unpkg.com/moment@2.30.1/min/locales.min.js"></script>
    <script src="https://unpkg.com/moment-lunar@0.0.4/moment-lunar.js"></script>

    <script src="https://unpkg.com/js-calendar-converter@0.0.7/dist/js-calendar-converter.js"></script>
    <script src="https://unpkg.com/lodash@4.17.21/lodash.min.js"></script>
    <!-- <script src="https://unpkg.com/simple-ini@1.0.4/lib/simple-ini.js"></script> -->

    <script>
      (function () {
        var script = document.createElement('script');
        script.src = './script.js?v=' + Date.now();
        document.body.appendChild(script);
      })();
    </script>
    <script>
      $(function () {});
    </script>
    <script>
      moment.locale('zh-CN');
      $(function () {
        setInterval(function () {
          $('#app-time').text(moment().format('HH:mm:ss'));
        }, 500);
        console.log([moment().year(), moment().month() + 1, moment().date()]);
        const currentLunar = calendar.solar2lunar(moment().year(), moment().month() + 1, moment().date());
        console.log(currentLunar);
        $('#app-date').text(moment().format('M月D日 dddd') + ' ' + currentLunar.IMonthCn + currentLunar.IDayCn);
      });
      function getTime() {
        var date = new Date();

        // 年、月、日
        var year = date.getFullYear();
        var month = ('00' + (date.getMonth() + 1)).slice(-2);
        var day = ('00' + date.getDate()).slice(-2);

        // 时、分、秒
        var hour = ('00' + date.getHours()).slice(-2);
        var minute = ('00' + date.getMinutes()).slice(-2);
        var second = ('00' + date.getSeconds()).slice(-2);

        // 实时显示
        var element = document.getElementById('app-time');
        element.innerText = '' + year + '-' + month + '-' + day + ' ' + hour + ':' + minute + ':' + second;
      }

      // setInterval("getTime()", 1000);
      function isEmpty(value) {
        // 判断 null 或 undefined
        if (value === null || value === undefined) return true;

        // 判断空字符串
        if (typeof value === 'string' && value.trim() === '') return true;

        // 判断空数组
        if (Array.isArray(value) && value.length === 0) return true;

        // 判断空对象
        if (typeof value === 'object' && Object.keys(value).length === 0) return true;

        return false;
      }
      $(function () {
        fetch('./dataset.json?v=' + Date.now())
          .then(response => response.json())
          .then(res => {
            console.log(res);
            const { navs } = res;

            const navGroups = navs
              .filter(v => v.slug && v.type == 'category' && !v.hidden)
              .reduce((t, v) => {
                const index = v.carousel || 0;
                if (!t[index]) t[index] = [];
                t[index].push(v);
                return t;
              }, []);

            let carouselIndicatorHtml = ``;
            let carouselInnerHtml = ``;
            navGroups.forEach((group, g_index) => {
              carouselIndicatorHtml += `<li data-target="#app-carousel" data-slide-to="${g_index}" class="${g_index == 0 ? 'active' : ''}"></li>`;
              let tabHtml = ``;
              let tabContentHtml = ``;
              group
                .sort((a, b) => a.order - b.order)
                .forEach((nav, nav_i) => {
                  tabHtml += `
                      <li class="nav-item" role="presentation">
                        <button class="nav-link btn-block text-light font-weight-bolder ${nav_i == 0 ? 'active' : ''}" id="${nav.slug}-tab" data-toggle="tab" data-target="#${nav.slug}" type="button" role="tab" aria-controls="${nav.slug}" aria-selected="true">
                          ${nav.name || nav.slug}
                        </button>
                      </li>
                      `;

                  tabContentHtml += `<div class="tab-pane fade ${nav_i == 0 ? 'show active' : ''}" id="${nav.slug}" role="tabpanel" aria-labelledby="${nav.slug}-tab">`;
                  tabContentHtml += `<nav aria-label="breadcrumb">
                        <ol class="breadcrumb mb-2 py-0 justify-content-center bg-dark--4">
                          <li class="breadcrumb-item active"><a href="#" class="badge badge-primary">ALL</a></li>
                        </ol>
                      </nav>`;
                  tabContentHtml += ` <div class="row row-cols-16 row-cols-sm-10 row-cols-md-12 text-center mx-0 masonry">`;
                  tabContentHtml += `<div class="col col--1 row--1 masonry-item px-0 text-decoration-none"></div>`;
                  [...(nav.children || []).filter(v => v.slug && v.recommand), ...(nav.children || []).filter(v => v.slug && !v.recommand).sort((a, b) => a.order - b.order)].forEach((child, child_i) => {
                    tabContentHtml += `<div class="col col--${child.col || 1} row--${child.row || 1} masonry-item px-0 text-decoration-none" data-id="${child.slug}--${child_i}">`;

                    tabContentHtml += makeCard(child, child_i);
                    tabContentHtml += `</div>`;
                  });
                  tabContentHtml += `</div> </div>`;
                });
              carouselInnerHtml += `
                    <div class="carousel-item ${g_index == 0 ? 'active' : ''}">
                      <ul id="app-tab--${g_index}" class="nav nav-pills nav-justified mb-2" role="tablist" style="background-color: rgba(0, 0, 0, 0.3)">${tabHtml}</ul>

                      <div id="app-tab-content--${g_index}" class="tab-content">${tabContentHtml}</div>

                    </div>`;
            });
            $('#app-carousel--indicators').html(carouselIndicatorHtml);
            $('#app-carousel--inner').html(carouselInnerHtml);
            $('[data-toggle="tooltip"]').tooltip({});
            // console.log($('.masonry').eq(0));
            $('.masonry').eq(0).masonry({
              // options
              itemSelector: '.masonry-item',
              percentPosition: true
            });
            $('img.lazy').lazyload({
              placeholder: 'https://unpkg.com/@fortawesome/fontawesome-free@7.0.0/svgs/solid/earth-america.svg' // 占位符图片
            });
            $('button[data-toggle="tab"]').on('shown.bs.tab', function (event) {
              // console.log(event.target);
              // console.log(event.relatedTarget);
              // console.log($(event.target).data("target"));
              // console.log($(event.relatedTarget).data("target"));
              $($(event.target).data('target') + '>.masonry').masonry({
                // options
                itemSelector: '.masonry-item',
                percentPosition: true
              });
              $('img.lazy').lazyload({
                placeholder: 'https://unpkg.com/@fortawesome/fontawesome-free@7.0.0/svgs/solid/earth-america.svg' // 占位符图片
              });
            });
            var tableRows = {
              1: { name: 'First row', isEditable: true, isRemovable: true },
              2: { name: 'Second row', isEditable: true, isRemovable: true },
              3: { name: 'Third row', isEditable: true, isRemovable: true }
            };

            var menu = new BootstrapMenu('.masonry-item.col.col--1.row--1>.card', {
              /* $rowElem is the jQuery element where the menu was opened. The
               * returned value is the `row` argument passed to each function. */
              fetchElementData: function ($rowElem) {
                console.log($rowElem);
                console.log($rowElem.data('id'));
                return $rowElem;
                //   var rowId = $rowElem.data('rowId');
                //   return tableRows[rowId];
              },
              /* group actions by their id to make use of separators between
               * them in the context menu. Actions not added to any group with
               * this option will appear in a default group of their own. */
              // actionsGroups: [['setEditable', 'setUneditable'], ['deleteRow']],
              /* you can declare 'actions' as an object instead of an array,
               * and its keys will be used as action ids. */
              actions: {
                editName: {
                  name: 'Edit name',
                  iconClass: 'fa-pencil',
                  onClick: function (row) {
                    /* ... */
                    console.log(arguments, row);
                  },
                  isShown: function (row) {
                    return false;
                  },
                  isEnabled: function (row) {
                    return true;
                  }
                },
                editDescription: {
                  name: 'Edit description',
                  iconClass: 'fa-pencil',
                  onClick: function (row) {
                    /* ... */
                    console.log(arguments, row);
                  },
                  isShown: function (row) {
                    return false;
                  },
                  isEnabled: function (row) {
                    return true;
                  }
                },
                setEditable: {
                  name: 'Set editable',
                  iconClass: 'fa-unlock',
                  onClick: function (row) {
                    /* ... */
                    console.log(arguments, row);
                  },
                  isShown: function (row) {
                    return !true;
                  }
                },
                setUneditable: {
                  name: 'Set uneditable',
                  iconClass: 'fa-lock',
                  onClick: function (row) {
                    /* ... */
                    console.log(arguments, row);
                  },
                  isShown: function (row) {
                    return false;
                  }
                },
                showDetail: {
                  name: '详情',
                  iconClass: 'fa-circle-info',
                  onClick: function (element) {
                    console.log(arguments, element, $(element));
                    $('#' + element.data('id')).modal('show');
                  }
                },
                deleteRow: {
                  name: 'Delete row',
                  iconClass: 'fa-trash-o',
                  onClick: function (row) {
                    /* ... */
                    console.log(arguments, row);
                  },
                  isShown: function (row) {
                    return false;
                  },
                  isEnabled: function (row) {
                    return true && true;
                  }
                }
              }
            });
          })
          .then(res => {});
      });
    </script>
  </body>
</html>
