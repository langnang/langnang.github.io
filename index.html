<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script>
      document.title = location.host;
    </script>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <!-- CSS -->
    <link rel="stylesheet" href="https://unpkg.com/bootstrap@4.6.2/dist/css/bootstrap.min.css" />

    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="app" class="container-fluid">
      <aside id="app-sidebar"></aside>
      <main id="app-main" class="container">
        <div class="jumbotron text-center p-0">
          <h1 id="app-time" class="strong display-4">--:--:--</h1>
          <p id="app-date" class="lead">---- -- --</p>
        </div>
        <div class="container">
          <div class="row"></div>
        </div>
      </main>
    </div>
    <div id="app" class="container d-flex flex-column justify-content-center" style="min-height: 100dvh"></div>
    <!-- jQuery and JavaScript Bundle with Popper -->
    <script src="https://unpkg.com/jquery@3.5.1/dist/jquery.slim.js"></script>
    <script src="https://unpkg.com/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

    <script src="https://unpkg.com/moment@2.30.1/min/moment.min.js"></script>
    <script src="https://unpkg.com/moment@2.30.1/min/locales.min.js"></script>
    <script src="https://unpkg.com/moment-lunar@0.0.4/moment-lunar.js"></script>

    <script src="https://unpkg.com/simple-ini@1.0.4/lib/simple-ini.js"></script>

    <script src="script.js"></script>
    <script>
      moment.locale("zh-CN");
      $(function () {
        setInterval(function () {
          $("#app-time").text(moment().format("HH:mm:ss"));
        }, 500);
        $("#app-date").text(moment().format("M月D日 dddd") + " " + moment().lunar().format("MMMMDo"));
      });
      function getTime() {
        var date = new Date();

        // 年、月、日
        var year = date.getFullYear();
        var month = ("00" + (date.getMonth() + 1)).slice(-2);
        var day = ("00" + date.getDate()).slice(-2);

        // 时、分、秒
        var hour = ("00" + date.getHours()).slice(-2);
        var minute = ("00" + date.getMinutes()).slice(-2);
        var second = ("00" + date.getSeconds()).slice(-2);

        // 实时显示
        var element = document.getElementById("app-time");
        element.innerText = "" + year + "-" + month + "-" + day + " " + hour + ":" + minute + ":" + second;
      }

      // setInterval("getTime()", 1000);
      function isEmpty(value) {
        // 判断 null 或 undefined
        if (value === null || value === undefined) return true;

        // 判断空字符串
        if (typeof value === "string" && value.trim() === "") return true;

        // 判断空数组
        if (Array.isArray(value) && value.length === 0) return true;

        // 判断空对象
        if (typeof value === "object" && Object.keys(value).length === 0) return true;

        return false;
      }
      $(function () {
        function makeBreadcrumb(key, root) {
          // console.log(key);
          const data = { ...(root[key] || {}) };
          if (isEmpty(data.NAME)) data.NAME = key;
          return `<div class="row">
          <nav class="col px-1" aria-label="breadcrumb">
            <ol class="breadcrumb py-2 mb-2">
              <li class="breadcrumb-ite" aria-current="page">${data.NAME}</li>
            </ol>
          </nav>
          </div>`;
        }
        function makeCardGroup(key, root) {
          // console.log(key);
          // console.log(root[key]);
          const data = { ...(root[key] || {}) };
          return (
            `<div class="row row-cols-1 row-cols-sm-2 row-cols-md-4">` +
            (data["CHILDREN"] || "")
              .split(",")
              .filter((v) => v)
              .reduce((t, v) => t + makeCard(v, key, root), "") +
            ` </div>`
          );
        }
        function makeCard(key, parentKey, root) {
          const data = { ...(root[parentKey + "::" + key] || {}) };
          // console.log(key, parentKey, isEmpty(data.NAME));
          // console.log(data);
          if (isEmpty(data.NAME)) data.NAME = key;
          // console.log(data);
          return (
            (isEmpty(data.URL) ? "" : `<a class="text-decoration-none" target="_blank" href="${data.URL}">`) +
            `` +
            `<div class="col px-1 mb-2">
              <div class="card">
              <div class="card-body px-1 py-2">
                <div class="media">
                <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" class="align-self-center mr-1 text-secondary" style="width: 1.5rem">
                  <path d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div class="media-body">
                  <h5 class="my-0">${data.NAME}</h5>
                </div>
              </div>
              </div>
              </div>
            </div>` +
            (isEmpty(data.URL) ? "" : `</a>`)
          );
        }
        function makeHtml(data) {
          return (data["CHILDREN"] || "")
            .split(",")
            .filter((v) => v)
            .reduce((t, v) => t + makeBreadcrumb(v, data) + makeCardGroup(v, data), "");
        }
        function loadHtml() {
          fetch("./.env?" + Date.now())
            .then((response) => response.text())
            .then((res) => {
              const iniObject = new SimpleIni(function () {
                return res.replace(/\r/g, "");
              });
              // console.log(iniObject);
              // console.log(iniObject["CHILDREN"].split(",").slice(0, -1));
              $("#app").html(makeHtml({ ...iniObject }));
            });
        }

        // loadHtml();
      });
    </script>
  </body>
</html>
